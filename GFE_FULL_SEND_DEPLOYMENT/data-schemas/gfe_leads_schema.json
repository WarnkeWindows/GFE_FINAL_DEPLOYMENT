{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "GFE Leads Collection Schema",
  "description": "Schema definition for Good Faith Exteriors leads collection",
  
  "wixCollection": {
    "id": "GFE_Leads",
    "displayName": "GFE Leads",
    "description": "Lead management for Good Faith Exteriors",
    "permissions": {
      "insert": "ADMIN",
      "update": "ADMIN",
      "remove": "ADMIN",
      "read": "ADMIN"
    }
  },

  "properties": {
    "_id": {
      "type": "string",
      "description": "Unique identifier (auto-generated by Wix)",
      "readOnly": true
    },
    
    "_createdDate": {
      "type": "string",
      "format": "date-time",
      "description": "Creation timestamp (auto-generated by Wix)",
      "readOnly": true
    },
    
    "_updatedDate": {
      "type": "string", 
      "format": "date-time",
      "description": "Last update timestamp (auto-generated by Wix)",
      "readOnly": true
    },

    "fullName": {
      "type": "string",
      "title": "Full Name",
      "description": "Customer's full name",
      "minLength": 2,
      "maxLength": 100,
      "pattern": "^[a-zA-Z\\s\\-\\.]+$",
      "wixField": {
        "type": "text",
        "displayName": "Full Name",
        "required": true
      }
    },

    "email": {
      "type": "string",
      "title": "Email Address",
      "description": "Customer's email address",
      "format": "email",
      "maxLength": 255,
      "wixField": {
        "type": "text",
        "displayName": "Email",
        "required": true
      }
    },

    "phone": {
      "type": "string",
      "title": "Phone Number",
      "description": "Customer's phone number",
      "pattern": "^[0-9\\-\\(\\)\\+\\s]+$",
      "minLength": 10,
      "maxLength": 20,
      "wixField": {
        "type": "text",
        "displayName": "Phone",
        "required": false
      }
    },

    "projectType": {
      "type": "string",
      "title": "Project Type",
      "description": "Type of window/door project",
      "enum": [
        "Window Replacement",
        "New Construction",
        "Door Installation", 
        "Repair/Maintenance",
        "Consultation",
        "General Inquiry"
      ],
      "default": "Window Replacement",
      "wixField": {
        "type": "text",
        "displayName": "Project Type",
        "required": false
      }
    },

    "customerAddress": {
      "type": "string",
      "title": "Customer Address",
      "description": "Customer's physical address",
      "maxLength": 500,
      "wixField": {
        "type": "text",
        "displayName": "Address",
        "required": false
      }
    },

    "notes": {
      "type": "string",
      "title": "Notes",
      "description": "Additional notes about the lead",
      "maxLength": 2000,
      "wixField": {
        "type": "richText",
        "displayName": "Notes",
        "required": false
      }
    },

    "source": {
      "type": "string",
      "title": "Lead Source",
      "description": "Where the lead came from",
      "enum": [
        "Website",
        "AI Estimator",
        "Referral",
        "Social Media",
        "Google Ads",
        "Phone Call",
        "Email",
        "Trade Show",
        "Direct Mail",
        "Other"
      ],
      "default": "Website",
      "wixField": {
        "type": "text",
        "displayName": "Source",
        "required": true
      }
    },

    "status": {
      "type": "string",
      "title": "Lead Status",
      "description": "Current status of the lead",
      "enum": [
        "new",
        "contacted",
        "qualified",
        "quoted",
        "appointment_scheduled",
        "in_progress",
        "closed_won",
        "closed_lost",
        "on_hold"
      ],
      "default": "new",
      "wixField": {
        "type": "text",
        "displayName": "Status",
        "required": true
      }
    },

    "leadScore": {
      "type": "integer",
      "title": "Lead Score",
      "description": "Calculated lead score (0-100)",
      "minimum": 0,
      "maximum": 100,
      "default": 50,
      "wixField": {
        "type": "number",
        "displayName": "Lead Score",
        "required": false
      }
    },

    "priority": {
      "type": "string",
      "title": "Priority Level",
      "description": "Priority level based on lead score",
      "enum": [
        "low",
        "medium", 
        "high",
        "urgent"
      ],
      "default": "medium",
      "wixField": {
        "type": "text",
        "displayName": "Priority",
        "required": false
      }
    },

    "assignedTo": {
      "type": "string",
      "title": "Assigned To",
      "description": "Team member assigned to this lead",
      "format": "email",
      "enum": [
        "nick@goodfaithexteriors.com",
        "rich@goodfaithexteriors.com",
        "sales@goodfaithexteriors.com",
        "info@goodfaithexteriors.com"
      ],
      "wixField": {
        "type": "text",
        "displayName": "Assigned To",
        "required": false
      }
    },

    "followUpDate": {
      "type": "string",
      "format": "date-time",
      "title": "Follow Up Date",
      "description": "When to follow up with this lead",
      "wixField": {
        "type": "dateTime",
        "displayName": "Follow Up Date",
        "required": false
      }
    },

    "lastContactDate": {
      "type": "string",
      "format": "date-time", 
      "title": "Last Contact Date",
      "description": "When this lead was last contacted",
      "wixField": {
        "type": "dateTime",
        "displayName": "Last Contact",
        "required": false
      }
    },

    "estimatedProjectValue": {
      "type": "number",
      "title": "Estimated Project Value",
      "description": "Estimated value of the project in USD",
      "minimum": 0,
      "maximum": 100000,
      "wixField": {
        "type": "number",
        "displayName": "Est. Project Value",
        "required": false
      }
    },

    "leadData": {
      "type": "object",
      "title": "Additional Lead Data",
      "description": "Additional structured data about the lead",
      "properties": {
        "windowCount": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        },
        "preferredContactMethod": {
          "type": "string",
          "enum": ["email", "phone", "text"]
        },
        "bestTimeToContact": {
          "type": "string",
          "enum": ["morning", "afternoon", "evening", "anytime"]
        },
        "homeAge": {
          "type": "string",
          "enum": ["new", "5-10_years", "10-20_years", "20+_years"]
        },
        "urgency": {
          "type": "string",
          "enum": ["immediate", "within_month", "within_3_months", "no_rush"]
        },
        "budget": {
          "type": "string",
          "enum": ["under_5k", "5k-15k", "15k-30k", "30k+", "no_budget_set"]
        }
      },
      "wixField": {
        "type": "object",
        "displayName": "Lead Data",
        "required": false
      }
    },

    "marketingOptIn": {
      "type": "boolean",
      "title": "Marketing Opt-In",
      "description": "Customer opted in to marketing communications",
      "default": false,
      "wixField": {
        "type": "boolean",
        "displayName": "Marketing Opt-In",
        "required": false
      }
    },

    "tags": {
      "type": "array",
      "title": "Tags",
      "description": "Tags for categorizing leads",
      "items": {
        "type": "string",
        "enum": [
          "hot_lead",
          "cold_lead",
          "callback_requested",
          "quote_sent",
          "appointment_set",
          "referral",
          "ai_generated",
          "high_value",
          "competitor_shopping"
        ]
      },
      "uniqueItems": true,
      "maxItems": 10,
      "wixField": {
        "type": "array",
        "displayName": "Tags",
        "required": false
      }
    },

    "sessionId": {
      "type": "string",
      "title": "Session ID",
      "description": "Website session ID when lead was created",
      "pattern": "^[a-zA-Z0-9\\-]+$",
      "wixField": {
        "type": "text",
        "displayName": "Session ID",
        "required": false
      }
    },

    "utmParams": {
      "type": "object",
      "title": "UTM Parameters",
      "description": "Marketing tracking parameters",
      "properties": {
        "utm_source": {
          "type": "string",
          "maxLength": 100
        },
        "utm_medium": {
          "type": "string", 
          "maxLength": 100
        },
        "utm_campaign": {
          "type": "string",
          "maxLength": 100
        },
        "utm_term": {
          "type": "string",
          "maxLength": 100
        },
        "utm_content": {
          "type": "string",
          "maxLength": 100
        }
      },
      "wixField": {
        "type": "object",
        "displayName": "UTM Parameters",
        "required": false
      }
    }
  },

  "required": [
    "fullName",
    "email",
    "source",
    "status"
  ],

  "indexes": [
    {
      "name": "email_index",
      "fields": ["email"],
      "unique": false
    },
    {
      "name": "status_priority_index", 
      "fields": ["status", "priority"],
      "unique": false
    },
    {
      "name": "assigned_followup_index",
      "fields": ["assignedTo", "followUpDate"],
      "unique": false
    },
    {
      "name": "source_created_index",
      "fields": ["source", "_createdDate"],
      "unique": false
    }
  ],

  "hooks": {
    "beforeInsert": "GFE_Leads_beforeInsert",
    "afterInsert": "GFE_Leads_afterInsert", 
    "beforeUpdate": "GFE_Leads_beforeUpdate",
    "afterUpdate": "GFE_Leads_afterUpdate"
  },

  "validationRules": {
    "emailFormat": {
      "rule": "email must be valid format",
      "field": "email",
      "validation": "format"
    },
    "phoneFormat": {
      "rule": "phone must contain only digits, spaces, hyphens, parentheses",
      "field": "phone", 
      "validation": "pattern"
    },
    "leadScoreRange": {
      "rule": "leadScore must be between 0 and 100",
      "field": "leadScore",
      "validation": "range"
    }
  },

  "businessRules": {
    "autoAssignment": {
      "description": "Automatically assign leads based on source or priority",
      "trigger": "beforeInsert",
      "conditions": [
        "if priority is 'high', assign to nick@goodfaithexteriors.com",
        "if source is 'AI Estimator', assign to rich@goodfaithexteriors.com",
        "otherwise round-robin assignment"
      ]
    },
    "leadScoring": {
      "description": "Calculate lead score based on available information",
      "trigger": "beforeInsert|beforeUpdate",
      "factors": [
        "email provided: +20 points",
        "phone provided: +20 points", 
        "project type 'Window Replacement': +10 points",
        "address provided: +5 points",
        "notes length > 20 chars: +5 points"
      ]
    },
    "followUpScheduling": {
      "description": "Set follow-up dates based on priority",
      "trigger": "beforeInsert|beforeUpdate",
      "rules": [
        "high priority: 2 hours",
        "medium priority: 24 hours",
        "low priority: 72 hours"
      ]
    }
  },

  "integrations": {
    "crm": {
      "syncToWixCRM": true,
      "createContact": true,
      "updateContact": true
    },
    "email": {
      "sendNotifications": true,
      "templates": ["lead_notification"]
    },
    "analytics": {
      "trackEvents": true,
      "events": ["lead_created", "lead_updated", "lead_converted"]
    }
  },

  "examples": [
    {
      "fullName": "John Smith",
      "email": "john.smith@email.com", 
      "phone": "(555) 123-4567",
      "projectType": "Window Replacement",
      "customerAddress": "123 Main St, Anytown, NY 12345",
      "notes": "Interested in replacing 8 windows. Prefers energy efficient options.",
      "source": "AI Estimator",
      "status": "new",
      "leadScore": 85,
      "priority": "high",
      "estimatedProjectValue": 12000,
      "leadData": {
        "windowCount": 8,
        "preferredContactMethod": "email",
        "bestTimeToContact": "evening",
        "urgency": "within_month",
        "budget": "15k-30k"
      },
      "tags": ["hot_lead", "ai_generated", "high_value"]
    }
  ],

  "documentation": {
    "description": "This schema defines the structure for lead records in the Good Faith Exteriors CRM system. Leads represent potential customers who have expressed interest in window or door services.",
    "usageNotes": [
      "All leads must have a valid email address",
      "Lead scores are automatically calculated based on available information", 
      "Follow-up dates are automatically set based on priority level",
      "Status changes trigger various automated workflows"
    ],
    "relatedCollections": [
      "GFE_Quotes",
      "GFE_Customers", 
      "GFE_Projects",
      "GFE_Appointments"
    ]
  }
}